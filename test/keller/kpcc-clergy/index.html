<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
<script src="http://projects.scpr.org/static/static-files/scripts/handlebars-1.0.rc.1.js"></script>
<script src="http://projects.scpr.org/static/static-files/scripts/swag.js"></script>
<script src="http://projects.scpr.org/static/static-files/scripts/moment.min.js"></script>

<script>
var jqueryNoConflict = jQuery;

//begin main function
jqueryNoConflict(document).ready(function(){
    retrieveKpccData();
    retrieveLatimesData();
});


/*KPCC API PARAMETERS

#### Public
types=segmentsORnewsORentries
query=mahony
limit=
page=

#### Private API
order=
sort_mode=
conditions=
*/


function retrieveKpccData(data){
    jqueryNoConflict.getJSON('http://www.scpr.org/api/content/?types=segmentsORnewsORentries&query=mahony&limit=20', renderKpccTemplate);
};

function renderKpccTemplate(data){
    var kpccArticles = {
        'objects': data
        };
    renderHandlebarsTemplate('kpcc-articles.handlebars', '#kpcc-articles', kpccArticles);
};


// begin
function retrieveLatimesData(laTimesData){
    var dataSource = 'scraped_data_file.json';
    jqueryNoConflict.getJSON(dataSource, renderLaTimesTemplate);
};

// run data visuals template function
function renderLaTimesTemplate(laTimesData){
    renderHandlebarsTemplate('latimes-articles.handlebars', '#latimes-articles', laTimesData);
};

// render handlebars templates via ajax
function getTemplateAjax(path, callback) {
    var source, template;
    jqueryNoConflict.ajax({
        url: path,
        success: function (data) {
            source = data;
            template = Handlebars.compile(source);
            if (callback) callback(template);
        }
    });
};

// function to compile handlebars template
function renderHandlebarsTemplate(withTemplate,inElement,withData){
    getTemplateAjax(withTemplate, function(template) {
        handlebarsFormatDateForDisplay();
        jqueryNoConflict(inElement).html(template(withData));
    })
};


// begin dateFormatFunction
function handlebarsFormatDateForDisplay(){
    Handlebars.registerHelper('dateFormat', function(context, block) {
        if (window.moment) {
            return takeTime(context);
        }else{
            return context;
        };
    });
};

// format date/time
function takeTime(dateInput) {
    var dateFormat = 'MMMM Do, YYYY';
    //var dateFormat = 'ddd., MMM., D, YYYY, h:mm a';
    var dateOutput = moment(dateInput).format(dateFormat);
    return dateOutput;
};


</script>

<div id="kpcc-articles"></div>
<hr>
<div id="latimes-articles"></div>