<!-- begin css  -->
<style type="text/css">
#map_container {width: 620px; height: 1100px;}
#map_data {width: 30%; height: auto; margin: 0 5% 50px 5%;}
#map_canvas {width: 80%; height: 600px; margin: 0 5% 50px 5%;}
</style>
<!-- end css -->


<!--
http://project.wnyc.org/news-maps/super-commuters/index-wnyc.html
-->

<!-- begin scripts -->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&region=us"></script>
<script type="text/javascript">

    var jqueryNoConflict = jQuery;
    var map;
    var geocoder = new google.maps.Geocoder();
    var userHometownLat;
    var userHometownLong;
    var userHometownLocation;
    var userServedLat;
    var userServedLong;
    var userServedLocation;
    var name;
    var hometown;
    var conflict;
    var servedIn;
    var lineColor;


    //begin main function
    jqueryNoConflict(document).ready(function(){
        createMap();
        retrieveData();


        setTimeout(function() {
            console.log(name, hometown, conflict, servedIn, lineColor);
        }, 3000);


    });

    // begin function
    function createMap() {

        var centerCalif = new google.maps.LatLng(37.335194502529724, -119.366455078125);

        map = new google.maps.Map(document.getElementById('map_canvas'), {
            center: centerCalif,
            zoom: 4,
            scrollwheel: false,
            draggable: true,
            mapTypeControl: false,
            navigationControl: true,
            streetViewControl: false,
            panControl: false,
            scaleControl: false,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            navigationControlOptions: {
                style: google.maps.NavigationControlStyle.SMALL,
                position: google.maps.ControlPosition.RIGHT_TOP}
        });


    };
    // end function


    // pull back the data
    function retrieveData (){
        var query = "SELECT * FROM " + '1Jy3EaU38dZVyjNBc3Ng_Q5rBhdZbAGcnouEbqMQ';
        var encodedQuery = encodeURIComponent(query);
        var apiKey = 'AIzaSyBJj_v-VYk6V7vzOIlIj88DiteiuMfpdN4';
        var dataUrl = 'https://www.googleapis.com/fusiontables/v1/query?sql=' + encodedQuery + '&key=' + apiKey + '&callback=?';

        $.getJSON(dataUrl, createArrayWith);
    };

    //begin function
    function createArrayWith(data){
       var rows = data['rows'];
        for (var i in rows) {
            name = rows[i][0];
            hometown = rows[i][1];
            conflict = rows[i][2];
            servedIn = rows[i][3];
            lineColor = rows[i][4];
        };
    }
    //end function

    // determine user destination
    function geocodeUserHometown(){
       geocoder.geocode( { 'address': hometown}, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                userHometownLat = results[0].geometry.location.lat();
                userHometownLong = results[0].geometry.location.lng();
                userHometownLocation = new google.maps.LatLng(userHometownLat,userHometownLong);
            } else {
                alert("Geocode was not successful for the following reason: " + status);
            }
            console.log('Geocoded:' + userHometownLocation);
            return userHometownLocation;

        });
    };

    // determine user destination
    function geocodeUserServed(){
       geocoder.geocode( { 'address': servedIn}, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                userServedLat = results[0].geometry.location.lat();
                userServedLong = results[0].geometry.location.lng();
                userServedLocation = new google.maps.LatLng(userServedLat,userServedLong);
            } else {
                alert("Geocode was not successful for the following reason: " + status);
            }
            console.log('Geocoded: ' + userServedLocation);
            return userServedLocation;
        });
    };


            geocodeUserHometown();
            geocodeUserServed();



</script>
<!-- end scripts -->

<!-- begin map container -->
<div id="map_container">

<h4>Using the map</h4>

<!-- begin map data -->
<div id="map_data">

</div>
<!-- end map data -->

<!-- begin map -->
<div id="map_canvas"></div>
<!-- end map -->

</div>
<!-- end map container -->